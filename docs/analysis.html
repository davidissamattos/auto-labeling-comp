<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Analysis | Automatic labeling comparisson</title>
  <meta name="description" content="Chapter 4 Analysis | Automatic labeling comparisson" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Analysis | Automatic labeling comparisson" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Analysis | Automatic labeling comparisson" />
  
  
  

<meta name="author" content="Teodor Fredriksson, David Issa Mattos, Jan Bosch, Helena Holmström Olsson" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="saving-the-csv-dataset.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#compiling-this-document"><i class="fa fa-check"></i>Compiling this document</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>1</b> Data preparation</a><ul>
<li class="chapter" data-level="1.1" data-path="data-preparation.html"><a href="data-preparation.html#merging-20news"><i class="fa fa-check"></i><b>1.1</b> Merging 20news</a></li>
<li class="chapter" data-level="1.2" data-path="data-preparation.html"><a href="data-preparation.html#merging-corpus"><i class="fa fa-check"></i><b>1.2</b> Merging corpus</a></li>
<li class="chapter" data-level="1.3" data-path="data-preparation.html"><a href="data-preparation.html#merging-cifar"><i class="fa fa-check"></i><b>1.3</b> Merging cifar</a></li>
<li class="chapter" data-level="1.4" data-path="data-preparation.html"><a href="data-preparation.html#merging-digits"><i class="fa fa-check"></i><b>1.4</b> Merging digits</a></li>
<li class="chapter" data-level="1.5" data-path="data-preparation.html"><a href="data-preparation.html#merging-wine"><i class="fa fa-check"></i><b>1.5</b> merging wine</a></li>
<li class="chapter" data-level="1.6" data-path="data-preparation.html"><a href="data-preparation.html#merging-iris"><i class="fa fa-check"></i><b>1.6</b> merging iris</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="correcting-a-few-typos-in-the-dataset-and-doing-some-renaming.html"><a href="correcting-a-few-typos-in-the-dataset-and-doing-some-renaming.html"><i class="fa fa-check"></i><b>2</b> Correcting a few typos in the dataset and doing some renaming</a></li>
<li class="chapter" data-level="3" data-path="saving-the-csv-dataset.html"><a href="saving-the-csv-dataset.html"><i class="fa fa-check"></i><b>3</b> Saving the csv dataset</a></li>
<li class="chapter" data-level="4" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>4</b> Analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="analysis.html"><a href="analysis.html#ranking-accuracy"><i class="fa fa-check"></i><b>4.1</b> Ranking accuracy</a><ul>
<li class="chapter" data-level="4.1.1" data-path="analysis.html"><a href="analysis.html#descriptive-statistics"><i class="fa fa-check"></i><b>4.1.1</b> Descriptive statistics</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="analysis.html"><a href="analysis.html#bradley-terry-model-for-ranking"><i class="fa fa-check"></i><b>4.2</b> Bradley terry model for ranking</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Automatic labeling comparisson</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Analysis</h1>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="analysis.html#cb13-1"></a>d &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;./data/auto-label-comparison.csv&#39;</span>)</span>
<span id="cb13-2"><a href="analysis.html#cb13-2"></a>dtime &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(d, ValueType<span class="op">==</span><span class="st">&#39;Time&#39;</span>)</span>
<span id="cb13-3"><a href="analysis.html#cb13-3"></a>dacc &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(d, ValueType<span class="op">==</span><span class="st">&#39;Accuracy&#39;</span>)</span></code></pre></div>
<div id="ranking-accuracy" class="section level2">
<h2><span class="header-section-number">4.1</span> Ranking accuracy</h2>
<p>This is just an example on how to analyze the data. I will be using bayesian data analysis here….</p>
<div id="descriptive-statistics" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Descriptive statistics</h3>
<div id="generate-some-tables" class="section level4">
<h4><span class="header-section-number">4.1.1.1</span> Generate some tables</h4>
<p>Using the latex option you can generate the latex table automatically
You can either copy and paste to latex or save it in a separate file and import it…</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="analysis.html#cb14-1"></a>dacc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="analysis.html#cb14-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(model, DatasetType) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-3"><a href="analysis.html#cb14-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Mean =</span> <span class="kw">mean</span>(Value),</span>
<span id="cb14-4"><a href="analysis.html#cb14-4"></a>            <span class="dt">Median =</span> <span class="kw">median</span>(Value)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-5"><a href="analysis.html#cb14-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#Now is just formating the dataframe to look like a nice table</span></span>
<span id="cb14-6"><a href="analysis.html#cb14-6"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> DatasetType, <span class="dt">values_from=</span><span class="kw">c</span>(<span class="st">&#39;Mean&#39;</span>, <span class="st">&#39;Median&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-7"><a href="analysis.html#cb14-7"></a><span class="st">  </span><span class="kw">kable</span>(<span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Model&quot;</span>,<span class="st">&#39;Image&#39;</span>, <span class="st">&#39;Numerical&#39;</span>, <span class="st">&#39;Text&#39;</span>, <span class="st">&#39;Image&#39;</span>, <span class="st">&#39;Numerical&#39;</span>, <span class="st">&#39;Text&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#There is the format option of </span></span>
<span id="cb14-8"><a href="analysis.html#cb14-8"></a><span class="st">  </span><span class="kw">add_header_above</span>(<span class="kw">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;Mean&quot;</span>=<span class="dv">3</span>, <span class="st">&quot;Median&quot;</span>=<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-9"><a href="analysis.html#cb14-9"></a><span class="st">  </span><span class="kw">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Mean
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Median
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Model
</th>
<th style="text-align:right;">
Image
</th>
<th style="text-align:right;">
Numerical
</th>
<th style="text-align:right;">
Text
</th>
<th style="text-align:right;">
Image
</th>
<th style="text-align:right;">
Numerical
</th>
<th style="text-align:right;">
Text
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
labelpropknn
</td>
<td style="text-align:right;">
0.1803436
</td>
<td style="text-align:right;">
0.4990864
</td>
<td style="text-align:right;">
0.3053600
</td>
<td style="text-align:right;">
0.0248602
</td>
<td style="text-align:right;">
0.3768728
</td>
<td style="text-align:right;">
0.3333333
</td>
</tr>
<tr>
<td style="text-align:left;">
labelproprbf
</td>
<td style="text-align:right;">
0.0180183
</td>
<td style="text-align:right;">
0.5667558
</td>
<td style="text-align:right;">
0.5160357
</td>
<td style="text-align:right;">
0.0180183
</td>
<td style="text-align:right;">
0.5349159
</td>
<td style="text-align:right;">
0.5265126
</td>
</tr>
<tr>
<td style="text-align:left;">
labelspreadknn
</td>
<td style="text-align:right;">
0.5701876
</td>
<td style="text-align:right;">
0.8331190
</td>
<td style="text-align:right;">
0.8462853
</td>
<td style="text-align:right;">
0.6192536
</td>
<td style="text-align:right;">
0.8264811
</td>
<td style="text-align:right;">
0.8285170
</td>
</tr>
<tr>
<td style="text-align:left;">
labelspreadrbf
</td>
<td style="text-align:right;">
0.6861312
</td>
<td style="text-align:right;">
0.7954410
</td>
<td style="text-align:right;">
0.2511023
</td>
<td style="text-align:right;">
0.7884933
</td>
<td style="text-align:right;">
0.8410380
</td>
<td style="text-align:right;">
0.3333333
</td>
</tr>
<tr>
<td style="text-align:left;">
QBC
</td>
<td style="text-align:right;">
0.5575380
</td>
<td style="text-align:right;">
0.9470665
</td>
<td style="text-align:right;">
0.8198721
</td>
<td style="text-align:right;">
0.5897392
</td>
<td style="text-align:right;">
0.9449465
</td>
<td style="text-align:right;">
0.8292117
</td>
</tr>
<tr>
<td style="text-align:left;">
random
</td>
<td style="text-align:right;">
0.5545589
</td>
<td style="text-align:right;">
0.9324540
</td>
<td style="text-align:right;">
0.7882019
</td>
<td style="text-align:right;">
0.5958778
</td>
<td style="text-align:right;">
0.9439340
</td>
<td style="text-align:right;">
0.7618463
</td>
</tr>
<tr>
<td style="text-align:left;">
uncertainty
</td>
<td style="text-align:right;">
0.5592158
</td>
<td style="text-align:right;">
0.9642017
</td>
<td style="text-align:right;">
0.8241434
</td>
<td style="text-align:right;">
0.5903052
</td>
<td style="text-align:right;">
0.9669744
</td>
<td style="text-align:right;">
0.8263763
</td>
</tr>
</tbody>
</table>
</div>
<div id="generate-some-basic-plots" class="section level4">
<h4><span class="header-section-number">4.1.1.2</span> Generate some basic plots</h4>
<p>Just to illustrate here some options</p>
<p>Aggregated by type of dataset</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="analysis.html#cb15-1"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>dacc, <span class="kw">aes</span>(<span class="dt">x=</span>model, <span class="dt">y=</span>Value, <span class="dt">fill=</span>model))<span class="op">+</span></span>
<span id="cb15-2"><a href="analysis.html#cb15-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()<span class="op">+</span></span>
<span id="cb15-3"><a href="analysis.html#cb15-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())<span class="op">+</span><span class="st"> </span><span class="co">#remove the x labels</span></span>
<span id="cb15-4"><a href="analysis.html#cb15-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>DatasetType)<span class="op">+</span></span>
<span id="cb15-5"><a href="analysis.html#cb15-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Box-plots for the accuracy&#39;</span>)</span></code></pre></div>
<p><img src="automatic-labelling_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;" />
By individual datasets</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="analysis.html#cb16-1"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>dacc, <span class="kw">aes</span>(<span class="dt">x=</span>model, <span class="dt">y=</span>Value, <span class="dt">fill=</span>model))<span class="op">+</span></span>
<span id="cb16-2"><a href="analysis.html#cb16-2"></a><span class="st">  </span><span class="kw">geom_boxplot</span>()<span class="op">+</span></span>
<span id="cb16-3"><a href="analysis.html#cb16-3"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())<span class="op">+</span><span class="st"> </span><span class="co">#remove the x labels</span></span>
<span id="cb16-4"><a href="analysis.html#cb16-4"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Dataset)<span class="op">+</span></span>
<span id="cb16-5"><a href="analysis.html#cb16-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Box-plots for the accuracy&#39;</span>)</span></code></pre></div>
<p><img src="automatic-labelling_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="bradley-terry-model-for-ranking" class="section level2">
<h2><span class="header-section-number">4.2</span> Bradley terry model for ranking</h2>
<p>To create a Bradley terry model we need first to transform our dataset to paired comparisons
On each iteration for each dataset for each variable we will rank the models based on the Value of the accuracy (lower accuracy -&gt; smaller)
After we expand it to wide so we can compare each algorithm with each other and create a BT dataset</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="analysis.html#cb17-1"></a>d_acc_rank &lt;-<span class="st"> </span>dacc <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-2"><a href="analysis.html#cb17-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Dataset, Variable, iterations) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-3"><a href="analysis.html#cb17-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">Rank=</span><span class="kw">rank</span>(Value, <span class="dt">ties.method =</span> <span class="st">&#39;random&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-4"><a href="analysis.html#cb17-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-5"><a href="analysis.html#cb17-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>Value) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#we need to drop the Value variable to pivot wider</span></span>
<span id="cb17-6"><a href="analysis.html#cb17-6"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> model,</span>
<span id="cb17-7"><a href="analysis.html#cb17-7"></a>                     <span class="dt">values_from=</span>Rank)</span></code></pre></div>
<p>Now we can create the BT dataset</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="analysis.html#cb18-1"></a><span class="co">#a vector with the name of the algorithms</span></span>
<span id="cb18-2"><a href="analysis.html#cb18-2"></a>models &lt;-<span class="st"> </span><span class="kw">get_index_names_as_array</span>(d<span class="op">$</span>model)</span>
<span id="cb18-3"><a href="analysis.html#cb18-3"></a></span>
<span id="cb18-4"><a href="analysis.html#cb18-4"></a>n_models =<span class="st"> </span><span class="kw">length</span>(models)</span>
<span id="cb18-5"><a href="analysis.html#cb18-5"></a>comb &lt;-<span class="st"> </span>gtools<span class="op">::</span><span class="kw">combinations</span>(<span class="dt">n=</span>n_models, <span class="dt">r=</span><span class="dv">2</span>, <span class="dt">v=</span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span>n_models), <span class="dt">repeats.allowed =</span> F) <span class="co">#all teh paired combinations</span></span>
<span id="cb18-6"><a href="analysis.html#cb18-6"></a></span>
<span id="cb18-7"><a href="analysis.html#cb18-7"></a>d_acc_bt &lt;-<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">tribble</span>(<span class="op">~</span>model0_name, <span class="op">~</span>model0, <span class="op">~</span>model1_name, <span class="op">~</span>model1, <span class="op">~</span>y, <span class="op">~</span>iterations, <span class="op">~</span>Dataset, <span class="op">~</span>DatasetType)</span>
<span id="cb18-8"><a href="analysis.html#cb18-8"></a></span>
<span id="cb18-9"><a href="analysis.html#cb18-9"></a><span class="co">#now we loop each row of the rank wide dataset and create a new one</span></span>
<span id="cb18-10"><a href="analysis.html#cb18-10"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(d_acc_rank))</span>
<span id="cb18-11"><a href="analysis.html#cb18-11"></a>{</span>
<span id="cb18-12"><a href="analysis.html#cb18-12"></a>  current_row &lt;-<span class="st"> </span>d_acc_rank[i,]</span>
<span id="cb18-13"><a href="analysis.html#cb18-13"></a>  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(comb)){</span>
<span id="cb18-14"><a href="analysis.html#cb18-14"></a>    comb_row &lt;-<span class="st"> </span>comb[j,]</span>
<span id="cb18-15"><a href="analysis.html#cb18-15"></a>    </span>
<span id="cb18-16"><a href="analysis.html#cb18-16"></a>    model0_name &lt;-<span class="st"> </span>models[comb_row[<span class="dv">1</span>]]</span>
<span id="cb18-17"><a href="analysis.html#cb18-17"></a>    model0 &lt;-<span class="st"> </span>comb_row[<span class="dv">1</span>]</span>
<span id="cb18-18"><a href="analysis.html#cb18-18"></a>    model0_rank &lt;-<span class="st"> </span>current_row[[<span class="dv">1</span>,model0_name]]</span>
<span id="cb18-19"><a href="analysis.html#cb18-19"></a>    </span>
<span id="cb18-20"><a href="analysis.html#cb18-20"></a>    model1_name &lt;-<span class="st"> </span>models[comb_row[<span class="dv">2</span>]]</span>
<span id="cb18-21"><a href="analysis.html#cb18-21"></a>    model1 &lt;-<span class="st"> </span>comb_row[<span class="dv">2</span>]</span>
<span id="cb18-22"><a href="analysis.html#cb18-22"></a>    model1_rank &lt;-<span class="st"> </span>current_row[[<span class="dv">1</span>,model1_name]]</span>
<span id="cb18-23"><a href="analysis.html#cb18-23"></a>    </span>
<span id="cb18-24"><a href="analysis.html#cb18-24"></a>    diff_rank &lt;-<span class="st"> </span>model1_rank <span class="op">-</span><span class="st"> </span>model0_rank</span>
<span id="cb18-25"><a href="analysis.html#cb18-25"></a>    <span class="co">#SInce higher accuracy is better if model 1 rank- model 0 rank is positive than model1 wins and y=1 else y=0</span></span>
<span id="cb18-26"><a href="analysis.html#cb18-26"></a>    y &lt;-<span class="st"> </span><span class="kw">ifelse</span>(diff_rank<span class="op">&gt;</span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>) </span>
<span id="cb18-27"><a href="analysis.html#cb18-27"></a>    </span>
<span id="cb18-28"><a href="analysis.html#cb18-28"></a>    </span>
<span id="cb18-29"><a href="analysis.html#cb18-29"></a>    d_acc_bt &lt;-d_acc_bt <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb18-30"><a href="analysis.html#cb18-30"></a><span class="st">      </span><span class="kw">add_row</span>(<span class="dt">model0_name=</span>model0_name,</span>
<span id="cb18-31"><a href="analysis.html#cb18-31"></a>              <span class="dt">model0=</span>model0,</span>
<span id="cb18-32"><a href="analysis.html#cb18-32"></a>              <span class="dt">model1_name=</span>model1_name,</span>
<span id="cb18-33"><a href="analysis.html#cb18-33"></a>              <span class="dt">model1=</span>model1,</span>
<span id="cb18-34"><a href="analysis.html#cb18-34"></a>              <span class="dt">y=</span>y,</span>
<span id="cb18-35"><a href="analysis.html#cb18-35"></a>              <span class="dt">iterations=</span>current_row<span class="op">$</span>iterations,</span>
<span id="cb18-36"><a href="analysis.html#cb18-36"></a>              <span class="dt">Dataset=</span>current_row<span class="op">$</span>Dataset,</span>
<span id="cb18-37"><a href="analysis.html#cb18-37"></a>              <span class="dt">DatasetType=</span>current_row<span class="op">$</span>DatasetType)</span>
<span id="cb18-38"><a href="analysis.html#cb18-38"></a>    </span>
<span id="cb18-39"><a href="analysis.html#cb18-39"></a>  }</span>
<span id="cb18-40"><a href="analysis.html#cb18-40"></a>}</span></code></pre></div>
<p>Now that we have the dataset we can run the model</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="analysis.html#cb19-1"></a><span class="kw">print_stan_code</span>(<span class="st">&#39;./models/rankingmodel.stan&#39;</span>)</span></code></pre></div>
<pre><code>// Ranking model
// Author: David Issa Mattos
// Date: 6 sept 2020
//
//

data {
 int &lt;lower=1&gt; N_total; // Sample size
 int y[N_total]; //variable that indicates which one wins model 0 or model 1

 int &lt;lower=1&gt; N_models; // Number of models
 
 int &lt;lower=1&gt; model0[N_total];
 int &lt;lower=1&gt; model1[N_total];
 
 // //To model the influence of each benchmark
 // int &lt;lower=1&gt; N_bm;
 // int bm_id[N_total];
}

parameters {
  real a_model[N_models]; //Latent variable that represents the strength value of each model
}

model {
  real p[N_total];

  a_model ~ normal(0,2);
  

  for (i in 1:N_total)
  {
     p[i] = a_model[model0[i]] - a_model[model1[i]];
  }
  
  y ~ bernoulli_logit(p);
}


//Uncoment this part to get the posterior predictives and the log likelihood
//But note that it takes a lot of space in the final model
// generated quantities{
//   vecor [N_total] y_rep;
//   vector[N_total] log_lik;
//   for(i in 1:N_total){
//     real p;
//     p = a_alg[algo1[i]] - a_alg[algo0[i]];
//     y_rep[i] = bernoulli_logit_rng(p);
//     
//     //Log likelihood
//      log_lik[i] = bernoulli_logit_lpmf(y[i] | p);
//   }
// }</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="analysis.html#cb21-1"></a>m1_data &lt;-<span class="st"> </span><span class="kw">list</span>(</span>
<span id="cb21-2"><a href="analysis.html#cb21-2"></a>  <span class="dt">N_total=</span><span class="kw">nrow</span>(d_acc_bt),</span>
<span id="cb21-3"><a href="analysis.html#cb21-3"></a>  <span class="dt">y =</span> <span class="kw">as.integer</span>(d_acc_bt<span class="op">$</span>y),</span>
<span id="cb21-4"><a href="analysis.html#cb21-4"></a>  <span class="dt">N_models =</span> <span class="kw">as.integer</span>(n_models),</span>
<span id="cb21-5"><a href="analysis.html#cb21-5"></a>  <span class="dt">model0=</span><span class="kw">as.integer</span>(d_acc_bt<span class="op">$</span>model0),</span>
<span id="cb21-6"><a href="analysis.html#cb21-6"></a>  <span class="dt">model1=</span><span class="kw">as.integer</span>(d_acc_bt<span class="op">$</span>model1)</span>
<span id="cb21-7"><a href="analysis.html#cb21-7"></a>  )</span></code></pre></div>
<p>Note that this is a stat model for ranking all the accuracy for all models. We can later sophisticate it a bit more but this should be more than enough for a conference</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="analysis.html#cb22-1"></a>m1_fit &lt;-<span class="st"> </span><span class="kw">stan</span>(<span class="dt">file =</span> <span class="st">&#39;./models/rankingmodel.stan&#39;</span>,</span>
<span id="cb22-2"><a href="analysis.html#cb22-2"></a>                     <span class="dt">data=</span>m1_data,</span>
<span id="cb22-3"><a href="analysis.html#cb22-3"></a>                     <span class="dt">chains =</span> <span class="dv">4</span>,</span>
<span id="cb22-4"><a href="analysis.html#cb22-4"></a>                     <span class="dt">warmup =</span> <span class="dv">200</span>,</span>
<span id="cb22-5"><a href="analysis.html#cb22-5"></a>                     <span class="dt">iter =</span> <span class="dv">2000</span>)</span>
<span id="cb22-6"><a href="analysis.html#cb22-6"></a><span class="kw">saveRDS</span>(m1_fit, <span class="dt">file =</span> <span class="st">&quot;./data/m1_fit.RDS&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="analysis.html#cb23-1"></a>m1_fit &lt;-<span class="kw">readRDS</span>(<span class="st">&quot;./data/m1_fit.RDS&quot;</span>)</span>
<span id="cb23-2"><a href="analysis.html#cb23-2"></a>a_model &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a_model[1]&quot;</span>,</span>
<span id="cb23-3"><a href="analysis.html#cb23-3"></a>           <span class="st">&quot;a_model[2]&quot;</span>,</span>
<span id="cb23-4"><a href="analysis.html#cb23-4"></a>           <span class="st">&quot;a_model[3]&quot;</span>,</span>
<span id="cb23-5"><a href="analysis.html#cb23-5"></a>           <span class="st">&quot;a_model[4]&quot;</span>,</span>
<span id="cb23-6"><a href="analysis.html#cb23-6"></a>           <span class="st">&quot;a_model[5]&quot;</span>,</span>
<span id="cb23-7"><a href="analysis.html#cb23-7"></a>           <span class="st">&quot;a_model[6]&quot;</span>,</span>
<span id="cb23-8"><a href="analysis.html#cb23-8"></a>           <span class="st">&quot;a_model[7]&quot;</span>)</span>
<span id="cb23-9"><a href="analysis.html#cb23-9"></a>rstan<span class="op">::</span><span class="kw">traceplot</span>(m1_fit, <span class="dt">pars=</span>a_model)</span></code></pre></div>
<p><img src="automatic-labelling_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="analysis.html#cb24-1"></a>hpdi &lt;-<span class="st"> </span><span class="kw">get_HPDI_from_stanfit</span>(m1_fit)</span>
<span id="cb24-2"><a href="analysis.html#cb24-2"></a></span>
<span id="cb24-3"><a href="analysis.html#cb24-3"></a>hpdi_algorithm &lt;-<span class="st"> </span>hpdi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb24-4"><a href="analysis.html#cb24-4"></a><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Parameter, <span class="st">&quot;a_model</span><span class="ch">\\</span><span class="st">[&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb24-5"><a href="analysis.html#cb24-5"></a><span class="st">      </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">Parameter=</span>models) </span>
<span id="cb24-6"><a href="analysis.html#cb24-6"></a></span>
<span id="cb24-7"><a href="analysis.html#cb24-7"></a><span class="kw">ggplot</span>(<span class="dt">data=</span>hpdi_algorithm, <span class="kw">aes</span>(<span class="dt">x=</span>Parameter))<span class="op">+</span></span>
<span id="cb24-8"><a href="analysis.html#cb24-8"></a><span class="st">  </span><span class="kw">geom_pointrange</span>(<span class="kw">aes</span>(</span>
<span id="cb24-9"><a href="analysis.html#cb24-9"></a>    <span class="dt">ymin=</span>HPDI.lower, </span>
<span id="cb24-10"><a href="analysis.html#cb24-10"></a>    <span class="dt">ymax=</span>HPDI.higher, </span>
<span id="cb24-11"><a href="analysis.html#cb24-11"></a>    <span class="dt">y=</span>Mean))<span class="op">+</span></span>
<span id="cb24-12"><a href="analysis.html#cb24-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y=</span><span class="st">&quot;Estimate&quot;</span>, <span class="dt">x=</span><span class="st">&quot;Model&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;HPDI interval of the strength of the model&quot;</span>)<span class="op">+</span></span>
<span id="cb24-13"><a href="analysis.html#cb24-13"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<p><img src="automatic-labelling_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>Here we are extracting all samples and ranking them to have a distribution of the ranks</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="analysis.html#cb25-1"></a>posterior &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw">extract</span>(m1_fit)</span>
<span id="cb25-2"><a href="analysis.html#cb25-2"></a>a_model &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(posterior<span class="op">$</span>a_model)</span>
<span id="cb25-3"><a href="analysis.html#cb25-3"></a><span class="kw">colnames</span>(a_model) &lt;-<span class="st"> </span>models</span>
<span id="cb25-4"><a href="analysis.html#cb25-4"></a><span class="co">#sampling from the posterior</span></span>
<span id="cb25-5"><a href="analysis.html#cb25-5"></a>s &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">sample_n</span>(a_model, <span class="dt">size =</span> <span class="dv">1000</span>, <span class="dt">replace=</span>T)</span>
<span id="cb25-6"><a href="analysis.html#cb25-6"></a>s &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(s, <span class="dt">rown =</span> <span class="kw">row_number</span>())</span>
<span id="cb25-7"><a href="analysis.html#cb25-7"></a>wide_s &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(s, <span class="dt">cols=</span><span class="kw">all_of</span>(models), <span class="dt">names_to =</span> <span class="st">&quot;Models&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;a_model&quot;</span>)</span>
<span id="cb25-8"><a href="analysis.html#cb25-8"></a></span>
<span id="cb25-9"><a href="analysis.html#cb25-9"></a>rank_df &lt;-<span class="st"> </span>wide_s <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-10"><a href="analysis.html#cb25-10"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(rown) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-11"><a href="analysis.html#cb25-11"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">Rank =</span> <span class="kw">rank</span>(<span class="op">-</span>a_model, <span class="dt">ties.method =</span> <span class="st">&#39;random&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-12"><a href="analysis.html#cb25-12"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-13"><a href="analysis.html#cb25-13"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>a_model) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-14"><a href="analysis.html#cb25-14"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">group_by</span>(Models) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-15"><a href="analysis.html#cb25-15"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">summarise</span>(<span class="dt">MedianRank =</span> <span class="kw">median</span>(Rank),</span>
<span id="cb25-16"><a href="analysis.html#cb25-16"></a>                   <span class="dt">VarianceRank =</span> <span class="kw">var</span>(Rank)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-17"><a href="analysis.html#cb25-17"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(MedianRank)</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="analysis.html#cb26-1"></a>rank_df_table &lt;-<span class="st"> </span>rank_df</span>
<span id="cb26-2"><a href="analysis.html#cb26-2"></a><span class="kw">colnames</span>(rank_df_table) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Models&quot;</span>,<span class="st">&quot;Median Rank&quot;</span>, <span class="st">&quot;Variance of the Rank&quot;</span>)</span>
<span id="cb26-3"><a href="analysis.html#cb26-3"></a><span class="kw">kable</span>(rank_df_table, <span class="st">&quot;html&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb26-4"><a href="analysis.html#cb26-4"></a><span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">bootstrap_options =</span> <span class="kw">c</span>(<span class="st">&#39;striped&#39;</span>,<span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span> ))</span></code></pre></div>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Models
</th>
<th style="text-align:right;">
Median Rank
</th>
<th style="text-align:right;">
Variance of the Rank
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
labelpropknn
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
labelproprbf
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
labelspreadrbf
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
random
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0.0158198
</td>
</tr>
<tr>
<td style="text-align:left;">
QBC
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.2636627
</td>
</tr>
<tr>
<td style="text-align:left;">
labelspreadknn
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
0.4159199
</td>
</tr>
<tr>
<td style="text-align:left;">
uncertainty
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0.4084795
</td>
</tr>
</tbody>
</table>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="saving-the-csv-dataset.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
